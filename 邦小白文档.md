## 邦小白文档

### 帮助

##### 1.寻找页面对应的activity

```java
tztActivityManager类中
getActivityByPageType方法功能号对应的activity全部包含
```

##### 2.字体分辨率等

```java
Res和Rc类中
```

##### 3.与H5交互网络请求

```java
tztWebviewFragmentBase类
```

```java
case "tzt":    
sendBXBH5Request_tzt(tag, posJson);  
break;
case "post":    
sendBXBH5Request_post(tag, posJson); 
break;
case "get":   
sendBXBH5Request_get(tag, posJson);  
break;
```

##### 4.弹窗和toast

```java
TebonToast
TebonDialogBase
```

##### 5.全局按钮背景色

```
tebon_v23_button_bg_disable
tebon_login_button_bg_selector
tebon_system_dialog_button_bg_press
tebon_trade_companyprofile_hqdata_more
```

##### 6.数据请求加载动画

```java
tebon_load_animation
```

##### 7.editext背景

```java
tebon_edittext_focused_bg
```

##### 8.返回监听

```
tztActivityBase
onKeyUp(int keyCode, KeyEvent event) {}
```

### 邦小白登录体系

#### 简述：

邦小白中一共存在3个账号，即留痕手机号，登录手机号和交易账号。其中留痕手机号是app第一次安装登录的手机号，如果app不重新下载安装，留痕手机号不会改变。登录手机号和交易账号是能退出的，登录的手机号为一级账号，交易账号为第二级账号

#### <u>一级登录</u>

- 留痕手机号（功能号44051： TebonRequest44051_HqLogin）

- 一键登录 （[官方文档](http://flash.253.com/document)）

- 手机号码登录

- 三方登录（[官方文档](http://www.mob.com/)）

- 适当性请求（tztRequest_UserBaseInfoCheck）

  
  
  ##### 一级账号的登录场景

| **必须一级登录的场景**      | **是否触发新手推荐** | **登录后操作以及跳转页面** |
| --------------------------- | -------------------- | -------------------------- |
| 下载APP后强制登录           | 是                   | 自选股                     |
| 个股详情点击评论            | 否                   | 个股详情页                 |
| 个股详情 - 股票评论点击评论 | 否                   | 股票评论页，评论弹框弹起   |
| 个股详情 - 股票评论点赞     | 否                   | 股票评论页，完成点赞       |
| 资讯详情页点击收藏          | 否                   | 资讯详情页，完成收藏       |
| 资讯详情页点击评论          | 否                   | 资讯详情页，评论弹框弹起   |
| 资讯详情页评论点赞          | 否                   | 资讯详情页，完成点赞       |
| 个人中心 - 点击登录/注册    | 否                   | 个人中心首页               |
| 个人中心 - 点击我的观点     | 否                   | 我的观点页                 |
| 个人中心 - 点击我的收藏     | 否                   | 我的收藏页                 |
| 个人中心 - 点击意见反馈     | 否                   | 意见反馈页                 |

##### app第一次启动后一级登录流程图

![8258d55bgy1g5ggtqsqi3j20lz0uaq4w-1565601862495.jpg](https://i.loli.net/2019/08/12/GBPL8ADVyn7iQvJ.jpg)



##### app整体一级登录流程图

![8258d55bly1g5de6vy33pj213a16z79a-1565601999843.jpg](https://i.loli.net/2019/08/12/q4IczZbMF8NKTe6.jpg)

##### 一级登录相关代码

- 存留痕手机号

  ```java
   new TebonImportantPhoneShared().onSaveData(Rc.getApplication(), mMobile);
  ```

- 取留痕手机号

  ```java
new TebonImportantPhoneShared().getImportantPhone()
  ```

- 德邦用户存储信息

  ```
TebonMobileRegistShared类中
  ```

  #### 一键登录
  
  **描述：一键登录功能号Pub.HQ_Login_Home**
  
  1.一键登录配置
  
  ```java
  tztHeadPageActivity类
  
   protected void onInitTdLogin() {
          TextView mOtherLogin = new TextView(getApplicationContext());
          RelativeLayout.LayoutParams lp = new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.WRAP_CONTENT, RelativeLayout.LayoutParams.WRAP_CONTENT);
          lp.setMargins(0, Res.Dip2Pix(400), 0, 0);
          lp.addRule(RelativeLayout.CENTER_HORIZONTAL);
          mOtherLogin.setText("其他方式登录");
          mOtherLogin.setTextSize(16);
          mOtherLogin.setTextColor(Color.parseColor("#FF276D"));
          mOtherLogin.setLayoutParams(lp);
          //自定义移动界面
          ShanYanUIConfig uiConfig = new ShanYanUIConfig.Builder()
                  //授权页导航栏：
                  .setNavColor(Color.parseColor("#ffffff"))  //设置导航栏颜色
                  .setNavText("")   //设置导航栏标题文字
                  .setNavTextColor(Color.parseColor("#ffffff"))//设置标题栏文字颜色
                  .setNavReturnImgPath("sy_sdk_left")        //设置导航栏返回按钮图标
                  //授权页logo（logo的层级在次底层，仅次于自定义控件）
                  .setLogoImgPath("tb_huanyin_icon")     //oauth_logo设置logo图片，引号内填图片名
                  .setLogoWidth(375)               //设置logo宽度
                  .setLogoHeight(119)              //设置logo高度
                  .setLogoOffsetY(70)                //设置logo相对于标题栏下边缘y偏移
                  .setLogoHidden(false)            //隐藏logo
                  //授权页号码栏：
                  .setNumberColor(Color.parseColor("#222222"))   //设置手机号码字体颜色
                  .setNumFieldOffsetY(272)                   //设置号码栏相对于标题栏下边缘y偏移
                  //授权页登录按钮：
                  .setLogBtnText("一键登录")      //设置登录按钮文字
                  .setLogBtnTextColor(Color.parseColor("#ffffff"))              //设置登录按钮文字颜色
                  .setLogBtnImgPath("tzt_v23_button_bg_normal")         //设置登录按钮图片
                  .setLogBtnOffsetY(320)   //  设置登录按钮相对于标题栏下边缘y偏移
  
                  .setAppPrivacyColor(Color.parseColor("#AAAAAA"), Color.parseColor("#AAAAAA"))//    设置隐私条款名称颜色(基础文字颜色，协议文字颜色)
                  .setPrivacyOffsetY(40)             //设置隐私条款相对于授权页面底部下边缘y偏移
                  //授权页slogan：
                  .setSloganTextColor(Color.parseColor("#AAAAAA"))    //设置移动slogan文字颜色
                  .setSloganOffsetY(Res.getScreenHeight(this, true) - Res.Dip2Pix(40))
                  .addCustomView(mOtherLogin, true, false, new ShanYanCustomInterface() {
                      @Override
                      public void onClick(Context context, View view) {
                          pTztDealRootInit.changePage(tztHeadPageActivity.this, Pub.HQ_Login_Phone,true);
                      }
                  })
                  .build();
          //自定义运营商授权页界面
          OneKeyLoginManager.getInstance().setAuthThemeConfig(uiConfig);
      }
  ```
  
  
  
   2.唤起一键登录
  
  ```java
  tztActivityManager类中
  
  public static void startNextActivity(final Activity curActivity,final Class<?> newActivity,final Bundle bundle,final boolean bSaveCurrActivity)
      {
        eKey.PARAM_PAGETYPE,Pub.HQ_Login_Phone);
                              onNext(curActivity,newActivity,bundle,bSaveCurrActivity);
                          }
  
                      }
                  });
  
              }
          }else {
              onNext(curActivity,newActivity,bundle,bSaveCurrActivity);
          }
  
      }
  ```
  
  
  
  ##### 手机号登录，3方登录
  
  ```java
  TebonHqAllLoginFragment类
  ```
  
  ##### 一级账号退出
  
  一级账号退出同时退出二级账号
  
  ```
  功能号 ： Pub.PersonalCenter_CommonLogout = (TZT_MENU_SYS_BEGIN + 62); //10362 退出非交易登录
  new tztPersonalCenterShared().onSaveData("",0,"");
                              //退出交易账号
                              tztLoginedInfo.getIns().ExitTrade(true);
                              //清空手机号相关信息
                              TebonMobileRegistShared.getIns().clearData();
                              //设置当前账号还没有绑定过资金账号
                              TebonMobileBindingTradeShared.getIns().clear(Rc.getApplication());
                              //清空本地自选股
                              tztUserStockShared.getIns().clsearSelStock(Rc.getApplication());
  ```
  
  #### 二级登录
  
  ##### 二级登录场景
  
  | **必须二级登录的场景**      | 是否触发绑定二级账号         |
  | --------------------------- | ---------------------------- |
  | 个股详情 - 点击买入买出     | 根据一级是否已经绑定二级账号 |
  | 个人中心 - 点击登录交易账户 | 登录弹窗                     |
  | 登录时长到期 - 根据需求     | 根据一级是否已经绑定二级账号 |
  | PUSH消息需要二级登录        | 根据一级是否已经绑定二级账号 |
  
  ##### 二级登录流程图
  
  ![1558595292455-a689d504-ebf9-47ae-bb67-e154823b720c.png](https://i.loli.net/2019/08/12/WGznfdLX7A86Pak.png)

H5登录成功的回调

```java
tztActivityBase

onSuccessLogin（）方法
```

```java
tztRootActivity类
/** * 登陆成功 */@Override
public void onSuccessLogin() {   
 if (mCurrFragment instanceof tztWebView10061Fragment) {      
 if (((tztWebView10061Fragment) mCurrFragment).getCurrWebView() != null)            ((tztWebView10061Fragment) mCurrFragment).getCurrWebView().GoBackOnLoad();   
}}
```

##### 业务逻辑描述：

- 场景1 ：用户为新用户 需要进入到交易体系（1.进行一级登录

  ​               2.进入绑定交易账号页面）

- 场景2：用户为老用户（一级登录后直接带出交易账号）

- 场景3：用户切换账号，登录的交易账号没有一级账号。（后台默认生成一个一级账号，把原来账号退出）

  

  ##### 触发交易弹窗代码

  ```
tztActivityBase
  涉及交易的逻辑判断
  changePage（）
  当前账号弹窗
  startOldUserDialog
  新交易弹窗
  startNewUserDialog
  ```
  
  ```
  登录请求入参
  initJYLogin（）
  ```
  
  ####          适当性弹窗
  
  登录成功后，调用适当性请求tztRequest_UserBaseInfoCheck
  
  ```java
  TebonSystemDialog类
  ```

##### 适当性弹窗逻辑流程图

![systemdialog-1565602097714.png](https://i.loli.net/2019/08/12/mghsnOpyE3k7lCG.png)

### 首页行情

类名TebonHuShenFragment

##### 大盘指数

```java
TebonHqTopDaPanLayout类

初始化setDpResParam
发送tztRequest_HqTopDapan请求
```

##### 热门榜单

```java
TebonHqSrokinglistLayout类
初始化数据
setTabLayout
请求网络数据
createReq
处理数据
doRefreshUI
传入不同值用于区分不同的榜单RecyclerviewAdapter（String flag）
```

热门行业，热门概念

```
TebonHqHorizontalLayout类
数据请求
createReq
数据处理
doRefreshUI方法  doRefreshData
添加view 
setLayoutItemView
视图
ViewPager 
```

##### 涨跌分布

```
TebonHqStocksFluctuationLayout类
```

涨跌分布图参考：[项目地址](https://github.com/PhilJay/MPAndroidChart)

##### 热门榜单更多股票页面

```java
TebonPaimingActivity类
```

### 搜索股票

```
TebonSearchStockFragment类
数据请求
createReq-->TebonSearchStockPresenter createReq-->mModel createReqHotStocks查询热门股票  mModel.createReq 股票搜索
数据请求
doRefreshUI
```

### 个股详情最下方买入买入卖出行

```java
addBuysellFragmelayoutTwo类
初始化
FrameLayout mBuyFrameLayout = new FrameLayout
TebonBuySellBottomView mBuySellBottomView = new TebonBuySellBottomView
请求数据回来后
RefreshBellowTrend
 mBuyFrameLayout.removeAllViews();
```

### 个股评论详情页面

```
case Pub.TrendCommentDetail功能号
```

```java
TebonCommentDetailFragment类
看跌看涨分布TebonZhangDieView
数据请求，获取评论列表
TebonRequest_Hq_Comments
获取最新价格
createPriceReq
```

- 一级账号未登录（点赞，添加评论，去登录页面后，回来请求点赞数据，显示评论弹窗）
- 一级账号已经登录（点赞，添加评论直接请求数据）

#### 买入卖出

```java
功能号
public static final int Trade_ShiJia_Buy = JY_Start + 151;// 市价委托买入 2151public static final int Trade_ShiJia_Sell = JY_Start + 152;// 市价委托买出 2152public static final int Trade_Advanced_ShiJia_Buy = JY_Start + 153;// 高级市价委托买入 2153public static final int Trade_Advanced_ShiJia_Sell = JY_Start + 154;// 高级市价委托卖出 2154
```

##### 交易流程图

![traend-1565602137407.png](https://i.loli.net/2019/08/12/FH5dxURqj2ubsmi.png)

交易相关代码

```java
tztTradeBuySellFragment类
初始化
onInit
判断是高级模式还是普通模式，展示不同Ui
 if(mPageType== Pub.Trade_ShiJia_Buy || mPageType== Pub.Trade_ShiJia_Sell){
 }
请求数据
  createOpenStatuStringReq();
```

#### 我的页面

##### 修改头像

```
Pub.PersonalCenter_ChageUserAvatar功能号
```

```java
AjaxWebClientUrlLis类
case Pub.PersonalCenter_ChageUserAvatar
   boolean bol = tztWebView.getTztWebViewAudioListener().onPhotograph(nAction, originUrl, reqMap);


```

```java
![未命名文件 (1)](C:%5CUsers%5Cyexiaotao%5CDesktop%5C%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20(1).png
bviewFragmentBase类
  mWebView.setTztWebViewAudioListener(new TztWebViewAudioListener()   {
            @Override
            public boolean onPhotograph(int nAction, String strUrlParam, Map<String, String> ayurlParam) {}
打开相机
 onOpenCamera
  选择相册
 onChosePhoto

```

```java
tztWebview10061Activity类
onActivityResult
压缩图片转换为base64请求图片上传请求TebonRequest_Hq_Post_UserAvatar
```

##### 修改手机号

###### 流程图

![changeuserpic-1565602157280.png](https://i.loli.net/2019/08/12/mOtBjhygzFepZ3w.png)

###### 修改手机号代码

```java
功能号 Pub.PersonalCenter_ChangePhoneNum
```

```
AjaxWebClientUrlLis类
case Pub.PersonalCenter_ChangePhoneNum:  
if (!Func.IsStringEmpty(getValueByUrl(url, "iphone")) && !"null".equals(getValueByUrl(url, "iphone"))) {        mBundle.putString(TeBonBundleKey.PARAM_TITLE, "手机号");        mBundle.putString(TeBonBundleKey.PARAM_PHONE,getValueByUrl(url, "iphone"));        c.changePage(mBundle, Pub.PersonalCenter_Phone, true);   
}else{
c.changePage(mBundle, Pub.PersonalCenter_Bing_Phone, true);    
}
```

###### 我的手机号

```java
功能号
case Pub.PersonalCenter_Phone
```

```java
TebonPhoneActivity
```

###### 绑定手机号

```java
功能号
case Pub.PersonalCenter_Bing_Phone://绑定手机号码
case Pub.PersonalCenter_Change_Phone:
```

```java
TebonBindingUserPhoneActivity
```

###### 验证资金账号

```java
功能号
case Pub.PersonalCenter_Check_Trade_User:
```

```
TebonTradeCheckActivity类
```

##### 客户号信息

```
AjaxWebClientUrlLis
case Pub.PersonalCenter_Custid:
```